<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Friday, May 31, 2019, 6:10 PM -->
<!-- MuClient version 5.06 -->

<!-- Plugin "track" generated by Plugin Wizard -->

<muclient>
<plugin
	name="track"
	author="Kloke"
	id="781c94cb64446457846cd334"
	language="Lua"
	purpose="highlight words - track add &lt;thing&gt; in a lovely colour"
	date_written="2019-05-31 18:08:55"
	requires="5.00"
	version="1.1"
	sequence="1"
	save_state="y"
   >
<description trim="y">
<![CDATA[
highlight the current track phrase. Usage:

	track					Show tracked items
	track add <item>		Add an item to tracked items
	track remove <item>		Remove item from tracked items
	track clear				Clear all tracked items
]]>
</description>

</plugin>

<!--  Triggers  -->

<triggers>
  <trigger
	custom_colour="17"
	enabled="y"
	ignore_case="y"
	keep_evaluating="y"
	name="trackthing"
	expand_variables="y"
	regexp="y"
	repeat="y"
	sequence="100"
	other_text_colour="red"
	match="(@!trackthing)"
  >
  </trigger>
</triggers>

<!--  Aliases  -->
<aliases>
<!-- Add item to track. -->
  <alias
   match="track add *"
   enabled="y"
   send_to="12"
   sequence="100"
   script="AddTrackedItem"
  >
  </alias>
  <!-- List tracked items. -->
  <alias
   match="track"
   enabled="y"
   send_to="12"
   sequence="100"
   script="trackShow"
  >
  </alias>
  <!-- Remove tracked item -->
  <alias
   match="track remove *"
   enabled="y"
   send_to="12"
   sequence="100"
   script="RemoveTrackeItem"
  >
  </alias>
  <!-- Clear all tracked items. -->
  <alias
   match="track clear"
   enabled="y"
   send_to="12"
   sequence="100"
   script="ClearAllTrackedItems"
  >
  </alias>
</aliases>

<!--  Plugin help  -->

<aliases>
  <alias
   script="OnHelp"
   match="track help"
   enabled="y"
  >
  </alias>
  <alias
   script="ShowSortedTrack"
   match="track sort"
   enabled="y"
  >
  </alias>
  
</aliases>

<script>
<![CDATA[
	require "tprint"
	require "serialize"
	TrackedItems = {}
	local trackthing = ""
	function OnHelp ()
		world.Note (world.GetPluginInfo (world.GetPluginID (), 3))
	end
	function AddTrackedItem (name,line,wildcards)
		local Track = wildcards[1]
		table.insert (TrackedItems, Track)
		CreateTrackVariable ()
	end -- function
	
	-- Create the track variable from the map
	trackthing = ""
	TrackedItems = {}
	function CreateTrackVariable ()
		trackthing = ""
		for k, v in pairs (TrackedItems) do
			--Note ("Debug: k: ".. k .. " v: " .. v)
			if (trackthing == "") then
				trackthing = trackthing .. v 
			else
				trackthing = trackthing .. "|" .. v
			end -- if
		end -- for
		trackShow ()
		SetVariable ("trackthing", trackthing)
		SetChanged (true)
	end -- function CreateTrackVariable
	
	function trackShow ()
		--Note (GetVariable("trackthing") or "Nothing")
		ColourNote ("red", "black", trackthing)
	end -- function trackShow
	
	-- Remove tracked item.
	function RemoveTrackeItem (name,line,wildcards)
		for k, v in pairs (TrackedItems) do
			--Note ("Debug: k: ".. k .. " v: " .. v)
			if (wildcards[1] == v) then
				table.remove (TrackedItems, k)
			end -- if
		end -- for
		CreateTrackVariable ()
		trackShow ()
	end -- function RemoveTrackeItem
	
	-- Clear all tracked items.
	function ClearAllTrackedItems (name,line,wildcards)
		TrackedItems = {}
		trackthing = ""
		SetVariable ("trackthing", trackthing)
		SetChanged (true)
	end -- function ClearAllTrackedItems
	
	function OnPluginInstall ()
		assert (loadstring (GetVariable ("TrackedItems") or "")) ()
	end -- function OnPluginInstall
	
	function OnPluginSaveState ()
		--tprint (TrackedItems)
		if (next (TrackedItems) ~= nil) then 
			SetVariable ("TrackedItems", "TrackedItems = " .. serialize.save_simple (TrackedItems))
		end -- if
	end -- function OnPluginSaveState
	
	function ShowSortedTrack ()
		table.sort (TrackedItems)
		table.foreachi (TrackedItems, print)
	end -- ShowSortedTrack

]]>
</script> 

</muclient>
